{"version":3,"sources":["audio-player.js"],"names":["define","langx","styler","noder","eventer","medias","$","plugins","players","ControlsBar","PlaybackAnimation","AudioPlayer","Plugin","inherit","klassName","pluginName","options","selectors","audio","audioControls","playbackAnimation","_construct","elm","prototype","call","this","$el","$audio","elmx","find","$audioControls","_controlsBar","instantiate","media","container","_playbackAnimation","listenTo","showControls","hideControls","document","keyboardShortcuts","createElement","canPlayType","controls","show","load","source","_media","title","url","href","type","posterUrl","poster","altText","_audio","$play","_$play","$poster","_$poster","prop","src","alt","download","play","stop","pause","togglePlay","paused","ended","hide","event","key","animatePlayback","setTimeout","_volumeControl","toggleMute","_fullscreen","toggleFullScreen","_pip","togglePip","register"],"mappings":";;;;;;;AAAAA,QACE,gBACA,sBACA,qBACA,uBACA,sBACA,qBACA,4BACA,YACA,iBACA,wBACA,SAASC,EAAMC,EAAOC,EAAOC,EAAQC,EAAOC,EAAIC,EAAQC,EAAQC,EAAYC,GAE5E,aAEA,IAAIC,EAAcJ,EAAQK,OAAOC,SAC/BC,UAAY,cAEZC,WAAa,qBAEbC,SACEC,WACEC,MAAQ,QACRC,cAAgB,gBAGhBC,kBAAoB,wBAMxBC,WAAY,SAASC,EAAKN,GAExBT,EAAQK,OAAOW,UAAUF,WAAWG,KAAKC,KAAKH,EAAIN,GAElD,IAAIU,EAAMD,KAAKnB,IACXW,EAAYQ,KAAKT,QAAQC,UAE7BQ,KAAKE,OAASF,KAAKG,OAAOC,KAAKZ,EAAUC,OAEzCO,KAAKK,eAAiBJ,EAAIG,KAAKZ,EAAUE,eAIzCM,KAAKM,aAAetB,EAAYuB,YAAYP,KAAKK,eAAe,IAC9DG,MAAQR,KAAKE,OACbO,UAAYT,KAAKG,SAOnBH,KAAKU,mBAAqBzB,EAAkBsB,YAAYN,EAAIG,KAAKZ,EAAUG,mBAAmB,IAC5Fa,MAAQR,KAAKE,SAMfF,KAAKW,SAASV,EAAI,aAAaD,KAAKY,cACpCZ,KAAKW,SAASV,EAAI,aAAaD,KAAKa,cA2BpCb,KAAKW,SAAS9B,EAAEiC,UAAU,QAAQd,KAAKe,qBAElBD,SAASE,cAAc,SAASC,cAEnDjB,KAAKE,OAAOgB,UAAS,GACrBlB,KAAKK,eAAec,QAGtBnB,KAAKoB,QAGPC,OAAS,SAASb,GAChBR,KAAKsB,OAASd,EACd,IAAIe,EAAQf,EAAMe,OAAS,GACvBC,EAAMhB,EAAMiB,KACZC,EAAOlB,EAAMkB,KACbC,EAAYnB,EAAMoB,QAAU,GAC5BC,EAAUrB,EAAMqB,SAAW,GAE3B5B,EAAMD,KAAKnB,IACXY,EAAQO,KAAK8B,OACbC,EAAQ/B,KAAKgC,OACbC,EAAUjC,KAAKkC,SAEnBjC,EAAIkC,KAAK,QAASZ,GAEd9B,EAAMwB,aACJO,GAAOE,GAAQjC,EAAMwB,YAAYS,KACnCjC,EAAM2C,IAAMZ,GAIhB/B,EAAMmC,OAASD,EAEfM,EAAQE,MACNC,IAAQT,EACRU,IAAQR,IAGVE,EAAMI,MACJG,SAAcf,EACdE,KAASD,KAKbJ,KAAO,WACLpB,KAAKE,OAAOkB,QAGdmB,KAAO,WACLvC,KAAKE,OAAOqC,QAIdC,KAAO,WACLxC,KAAKE,OAAOsC,QAGdC,MAAQ,WACNzC,KAAKE,OAAOuC,SAMdC,WAAa,WACP1C,KAAKE,OAAOyC,UAAY3C,KAAKE,OAAO0C,QACtC5C,KAAKE,OAAOqC,OAEZvC,KAAKE,OAAOuC,SAOhB5B,aAAe,WACTb,KAAKE,OAAOyC,UAIhB3C,KAAKK,eAAewC,QAItBjC,aAAe,WACbZ,KAAKK,eAAec,QAKtBJ,kBAAoB,SAAU+B,GAC5B,MAAMC,IAAEA,GAAQD,EAChB,OAAQC,GACN,IAAK,IACH/C,KAAK0C,aACL1C,KAAKU,mBAAmBsC,kBACpBhD,KAAKE,OAAOyC,SACd3C,KAAKY,eAELqC,WAAW,KACTjD,KAAKa,gBACJ,KAEL,MACF,IAAK,IACHb,KAAKkD,eAAeC,aACpB,MACF,IAAK,IACHnD,KAAKoD,YAAYC,mBACjB,MACF,IAAK,IACHrD,KAAKsD,KAAKC,gBAUlB,OAFAzE,EAAQ0E,SAAStE,GAEVH,EAAQG,YAAcA","file":"../audio-player.js","sourcesContent":["define([\r\n  \"skylark-langx\",\r\n  \"skylark-domx-styler\",\r\n  \"skylark-domx-noder\",\r\n  \"skylark-domx-eventer\",\r\n  \"skylark-domx-medias\",\r\n  \"skylark-domx-query\",\r\n  \"skylark-domx-plugins-base\",\r\n  \"./players\",\r\n  \"./controls-bar\",\r\n  \"./playback-animation\",\r\n],function(langx,styler,noder, eventer,medias,$ , plugins,players,ControlsBar,PlaybackAnimation) {\r\n\r\n  'use strict'\r\n\r\n  var AudioPlayer = plugins.Plugin.inherit({\r\n    klassName : \"AudioPlayer\",\r\n\r\n    pluginName : \"domx.players.audio\",\r\n   \r\n    options : {\r\n      selectors : {\r\n        audio : 'audio',\r\n        audioControls : '.controls-bar',\r\n\r\n\r\n        playbackAnimation : '.playback-animation',\r\n\r\n      }\r\n    },\r\n\r\n\r\n    _construct: function(elm, options) {\r\n      //this.options = options\r\n      plugins.Plugin.prototype._construct.call(this,elm,options);\r\n\r\n      let $el = this.$(),\r\n          selectors = this.options.selectors;\r\n\r\n      this.$audio = this.elmx().find(selectors.audio);\r\n\r\n      this.$audioControls = $el.find(selectors.audioControls);\r\n\r\n      //this._playButton = $el.find(selectors.playButton)[0];\r\n      //this._playbackIcons = $el.find(selectors.playbackIcons);\r\n      this._controlsBar = ControlsBar.instantiate(this.$audioControls[0],{\r\n        media : this.$audio,\r\n        container : this.elmx()\r\n      });\r\n\r\n\r\n\r\n      \r\n      //this._playbackAnimation = $el.find(selectors.playbackAnimation)[0];\r\n      this._playbackAnimation = PlaybackAnimation.instantiate($el.find(selectors.playbackAnimation)[0],{\r\n        media : this.$audio        \r\n      });\r\n      \r\n\r\n\r\n      // Add eventlisteners here\r\n      this.listenTo($el,'mouseenter',this.showControls);\r\n      this.listenTo($el,'mouseleave',this.hideControls);\r\n      /*\r\n      this.listenTo(this.$audio,'mouseenter',this.showControls);\r\n      this.listenTo(this.$audio,'mouseleave',this.hideControls);\r\n      this.listenTo(this.$audioControls,'mouseenter',this.showControls);\r\n      this.listenTo(this.$audioControls,'mouseleave',this.hideControls);\r\n      this.listenTo($(this._playButton),'click', this.togglePlay);\r\n      this.listenTo($(this._audio),'play',this.updatePlayButton);\r\n      this.listenTo($(this._audio),'pause',this.updatePlayButton);\r\n      this.listenTo($(this._audio),'loadedmetadata',this.initializeAudio);\r\n      this.listenTo($(this._audio),'timeupdate',this.updateTimeElapsed);\r\n      this.listenTo($(this._audio),'timeupdate',this.updateProgress);\r\n      this.listenTo($(this._audio),'volumechange',this.updateVolumeIcon);\r\n      this.listenTo($(this._audio),'click',this.togglePlay);\r\n      this.listenTo($(this._audio),'click',this.animatePlayback);\r\n      this.listenTo($(this._seek),'mousemove',this.updateSeekTooltip);\r\n      this.listenTo($(this._seek),'input',this.skipAhead);\r\n      this.listenTo($(this._volume),'input',this.updateVolume);\r\n      this.listenTo($(this._volumeButton),'click',this.toggleMute);\r\n      this.listenTo($(this._fullscreenButton),'click',this.toggleFullScreen);\r\n      this.listenTo($el,'fullscreenchange,webkitfullscreenchange',this.updateFullscreenButton);\r\n      this.listenTo($(this._pipButton),'click',this.togglePip);\r\n\r\n      if (!('pictureInPictureEnabled' in document)) {\r\n          this._pipButton.classList.add('hidden');\r\n      }\r\n      */\r\n      this.listenTo($(document),'keyup',this.keyboardShortcuts);\r\n      \r\n      const audioWorks = !!document.createElement('audio').canPlayType;\r\n      if (audioWorks) {\r\n        this.$audio.controls(false);\r\n        this.$audioControls.show();\r\n      }\r\n\r\n      this.load();\r\n    },\r\n\r\n    source : function(media) {\r\n      this._media = media;\r\n      let title = media.title || \"\",\r\n          url = media.href,\r\n          type = media.type,\r\n          posterUrl = media.poster || \"\",\r\n          altText = media.altText || \"\";\r\n\r\n      let $el = this.$(),\r\n          audio = this._audio,\r\n          $play = this._$play,\r\n          $poster = this._$poster;\r\n\r\n      $el.prop(\"title\", title);\r\n      \r\n      if (audio.canPlayType) {\r\n        if (url && type && audio.canPlayType(type)) {\r\n          audio.src = url\r\n        }    \r\n      }\r\n\r\n      audio.poster = posterUrl\r\n      \r\n      $poster.prop({\r\n        \"src\" : posterUrl,\r\n        \"alt\" : altText\r\n      });\r\n\r\n      $play.prop({\r\n        'download' :  title,\r\n        \"href\" : url\r\n      });\r\n    \r\n    },\r\n\r\n    load : function() {\r\n      this.$audio.load();\r\n    },\r\n\r\n    play : function() {\r\n      this.$audio.play();\r\n\r\n    },\r\n\r\n    stop : function() {\r\n      this.$audio.stop();\r\n    },\r\n\r\n    pause : function() {\r\n      this.$audio.pause();      \r\n    },\r\n\r\n    // togglePlay toggles the playback state of the audio.\r\n    // If the audio playback is paused or ended, the audio is played\r\n    // otherwise, the audio is paused\r\n    togglePlay : function () {\r\n      if (this.$audio.paused() || this.$audio.ended()) {\r\n        this.$audio.play();\r\n      } else {\r\n        this.$audio.pause();\r\n      }\r\n    },\r\n\r\n\r\n    // hideControls hides the audio controls when not in use\r\n    // if the audio is paused, the controls must remain visible\r\n    hideControls : function () {\r\n      if (this.$audio.paused()) {\r\n        return;\r\n      }\r\n\r\n      this.$audioControls.hide();\r\n    },\r\n\r\n    // showControls displays the audio controls\r\n    showControls : function () {\r\n      this.$audioControls.show();\r\n    },\r\n\r\n    // keyboardShortcuts executes the relevant functions for\r\n    // each supported shortcut key\r\n    keyboardShortcuts : function (event) {\r\n      const { key } = event;\r\n      switch (key) {\r\n        case 'k':\r\n          this.togglePlay();\r\n          this._playbackAnimation.animatePlayback();\r\n          if (this.$audio.paused()) {\r\n            this.showControls();\r\n          } else {\r\n            setTimeout(() => {\r\n              this.hideControls();\r\n            }, 2000);\r\n          }\r\n          break;\r\n        case 'm':\r\n          this._volumeControl.toggleMute();\r\n          break;\r\n        case 'f':\r\n          this._fullscreen.toggleFullScreen();\r\n          break;\r\n        case 'p':\r\n          this._pip.togglePip();\r\n          break;\r\n      }\r\n    }    \r\n\r\n\r\n  });\r\n\r\n  plugins.register(AudioPlayer);\r\n\r\n  return players.AudioPlayer = AudioPlayer;\r\n});\r\n\r\n"]}